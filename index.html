<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Mass & Balance Dornier 228</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
    input[type=number] {
      width: 100%;
      font-size: 16px;
      padding: 4px;
      box-sizing: border-box;
    }
    select {
      width: 100%;
      font-size: 16px;
      margin-bottom: 20px;
      padding: 6px;
    }
  </style>
</head>
<body>

<h2>Selecionar Avião</h2>
<select id="aviaoSelecionado" onchange="calculate()"></select>

<h2>Cálculo do Payload</h2>
<table>
  <tr><th>Tipo</th><th>Nº Passageiros</th><th>Peso total (kg)</th></tr>
  <tr><td>Homens</td><td><input type="number" id="men" value="0"></td><td id="menWeight">0</td></tr>
  <tr><td>Mulheres</td><td><input type="number" id="women" value="0"></td><td id="womenWeight">0</td></tr>
  <tr><td>Crianças</td><td><input type="number" id="children" value="0"></td><td id="childrenWeight">0</td></tr>
  <tr><td>Bagagem extra</td><td colspan="2"><input type="number" id="extraBag" value="0"></td></tr>
  <tr><td><strong>Payload total (kg)</strong></td><td colspan="2" id="totalPayload">0</td></tr>
</table>

<h2>Mass & Balance</h2>
<table>
  <tr><th>Item</th><th>Peso (kg)</th><th>Momento</th></tr>
  <tr><td>Peso Básico</td><td id="basicWeight">0</td><td id="basicMoment">0</td></tr>
  <tr><td>Payload</td><td id="payloadWeight">0</td><td id="payloadMoment">0</td></tr>
</table>

<script>
function getDefs() {
  return JSON.parse(localStorage.getItem('definicoesMB')) || {};
}

function preencherDropdown() {
  const defs = getDefs();
  const select = document.getElementById("aviaoSelecionado");
  if (!select) return;

  const avioes = defs.avioes || [];
  const ultimaSelecao = parseInt(localStorage.getItem('aviaoSelecionadoIndex')) || 0;

  select.innerHTML = "";
  avioes.forEach((aviao, index) => {
    const opt = document.createElement("option");
    opt.value = index;
    opt.text = `${aviao.nome} (${aviao.peso} kg)`;
    if (index === ultimaSelecao) opt.selected = true;
    select.appendChild(opt);
  });
}

function calculate() {
  const defs = getDefs();
  const pesoHomem = defs.pesoHomem || 96;
  const pesoMulher = defs.pesoMulher || 78;
  const pesoCrianca = defs.pesoCrianca || 35;
  const pesoBagagem = defs.pesoBagagem || 0;

  const avioes = defs.avioes || [];
  const select = document.getElementById("aviaoSelecionado");
  const selectedIndex = select ? select.selectedIndex : 0;
  const aviao = avioes[selectedIndex] || { peso: 3643, momento: 28051.1 };

  if (select) {
    localStorage.setItem('aviaoSelecionadoIndex', selectedIndex);
  }

  const men = parseInt(document.getElementById("men").value) || 0;
  const women = parseInt(document.getElementById("women").value) || 0;
  const children = parseInt(document.getElementById("children").value) || 0;
  const extraBag = parseFloat(document.getElementById("extraBag").value) || 0;

  const totalPayload = (men * pesoHomem) + (women * pesoMulher) + (children * pesoCrianca) + extraBag;

  document.getElementById("menWeight").innerText = men * pesoHomem;
  document.getElementById("womenWeight").innerText = women * pesoMulher;
  document.getElementById("childrenWeight").innerText = children * pesoCrianca;
  document.getElementById("totalPayload").innerText = totalPayload;

  const payloadMoment = totalPayload * 8.7; // braço médio de exemplo
  document.getElementById("payloadWeight").innerText = totalPayload;
  document.getElementById("payloadMoment").innerText = payloadMoment.toFixed(1);

  document.getElementById("basicWeight").innerText = aviao.peso;
  document.getElementById("basicMoment").innerText = aviao.momento;
}

document.querySelectorAll("input").forEach(i => i.addEventListener("input", calculate));
window.onload = () => {
  preencherDropdown();
  calculate();
};
</script>

<br><a href="settings.html">⚙️ Ir para definições</a>

</body>
</html>
